<!DOCTYPE html>
<html lang="sr">
<head>
    <meta charset="UTF-8">
    <title>SQL Manager (43 polja - demo UI)</title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <style>
        :root{
            --bg:#ffffff;
            --panel:#fafafa;
            --muted:#888;
            --border:#ccc;
            --accent:#0077cc;
        }
        html,body{
            height:100%; 
            margin:0; 
            padding:20px; 
            background:var(--bg); 
            font-family: Arial, Helvetica, sans-serif; 
            color:#111;
            padding-bottom: 150px; /* Dodali smo prazan prostor na dnu */
        }
        h2{margin:10px 0 12px 0;}
        .login-box{border:1px solid var(--border); padding:15px; margin-bottom:20px; background:var(--panel); border-radius:6px;}
        label{font-weight:700; display:block; margin-bottom:6px; font-size:14px;}
        input[type="text"], input[type="password"]{
            width:100%; box-sizing:border-box; padding:8px 10px; margin-bottom:10px;
            border:1px solid var(--border); border-radius:4px; font-size:14px;
        }
        button{
            display:inline-block; padding:8px 14px; margin:8px 8px 8px 0; border-radius:6px;
            border:1px solid var(--border); background:#fff; cursor:pointer; font-weight:600;
        }
        button:active{transform:translateY(1px);}
        #createResult, #widgetCode{
            background:#f4f4f4; padding:10px; border:1px solid var(--border);
            white-space:pre-wrap; max-height:300px; overflow:auto; border-radius:4px;
        }
        .grid{
            display:grid;
            grid-template-columns: repeat(6, 1fr);
            gap:15px;
            margin-top:12px;
        }
        .grid > div{min-width:0;}
        .field-label{font-size:13px; margin-bottom:6px; color:#222; font-weight:700;}
        .widget-panel{margin-top:20px;}
        @media (max-width:1200px){ .grid{grid-template-columns: repeat(4, 1fr);} }
        @media (max-width:800px){ .grid{grid-template-columns: repeat(2, 1fr);} }
        @media (max-width:420px){ .grid{grid-template-columns: 1fr;} button{width:100%; box-sizing:border-box;} }
    </style>
</head>
<body>
    <h2>Prijava</h2>
    <div class="login-box">
        <label for="username">Korisničko ime</label>
        <input type="text" id="username" placeholder="Unesi korisničko ime">

        <label for="password">Lozinka</label>
        <input type="password" id="password" placeholder="Unesi lozinku">
    </div>

    <h2>Kreiraj / Ažuriraj bazu</h2>
    <button id="createBtn">Kreiraj / Ažuriraj</button>
    <p id="createResult" aria-live="polite"></p>

    <div class="grid" id="fieldsGrid">
        <!-- Polja 1-43 -->
        <div><label class="field-label" for="field1">Odgovor 1</label><input type="text" id="field1"></div>
        <div><label class="field-label" for="field2">Pitanje 11</label><input type="text" id="field2"></div>
        <div><label class="field-label" for="field3">Pitanje 12</label><input type="text" id="field3"></div>
        <div><label class="field-label" for="field4">Pitanje 13</label><input type="text" id="field4"></div>
        <div><label class="field-label" for="field5">Pitanje 14</label><input type="text" id="field5"></div>
        <div><label class="field-label" for="field6">Pitanje 15</label><input type="text" id="field6"></div>
        <div><label class="field-label" for="field7">Odgovor 2</label><input type="text" id="field7"></div>
        <div><label class="field-label" for="field8">Pitanje 21</label><input type="text" id="field8"></div>
        <div><label class="field-label" for="field9">Pitanje 22</label><input type="text" id="field9"></div>
        <div><label class="field-label" for="field10">Pitanje 23</label><input type="text" id="field10"></div>
        <div><label class="field-label" for="field11">Pitanje 24</label><input type="text" id="field11"></div>
        <div><label class="field-label" for="field12">Pitanje 25</label><input type="text" id="field12"></div>
        <div><label class="field-label" for="field13">Odgovor 3</label><input type="text" id="field13"></div>
        <div><label class="field-label" for="field14">Pitanje 31</label><input type="text" id="field14"></div>
        <div><label class="field-label" for="field15">Pitanje 32</label><input type="text" id="field15"></div>
        <div><label class="field-label" for="field16">Pitanje 33</label><input type="text" id="field16"></div>
        <div><label class="field-label" for="field17">Pitanje 34</label><input type="text" id="field17"></div>
        <div><label class="field-label" for="field18">Pitanje 35</label><input type="text" id="field18"></div>
        <div><label class="field-label" for="field19">Odgovor 4</label><input type="text" id="field19"></div>
        <div><label class="field-label" for="field20">Pitanje 41</label><input type="text" id="field20"></div>
        <div><label class="field-label" for="field21">Pitanje 42</label><input type="text" id="field21"></div>
        <div><label class="field-label" for="field22">Pitanje 43</label><input type="text" id="field22"></div>
        <div><label class="field-label" for="field23">Pitanje 44</label><input type="text" id="field23"></div>
        <div><label class="field-label" for="field24">Pitanje 45</label><input type="text" id="field24"></div>
        <div><label class="field-label" for="field25">Odgovor 5</label><input type="text" id="field25"></div>
        <div><label class="field-label" for="field26">Pitanje 51</label><input type="text" id="field26"></div>
        <div><label class="field-label" for="field27">Pitanje 52</label><input type="text" id="field27"></div>
        <div><label class="field-label" for="field28">Pitanje 53</label><input type="text" id="field28"></div>
        <div><label class="field-label" for="field29">Pitanje 54</label><input type="text" id="field29"></div>
        <div><label class="field-label" for="field30">Pitanje 55</label><input type="text" id="field30"></div>
        <div><label class="field-label" for="field31">Odgovor 6</label><input type="text" id="field31"></div>
        <div><label class="field-label" for="field32">Pitanje 61</label><input type="text" id="field32"></div>
        <div><label class="field-label" for="field33">Pitanje 62</label><input type="text" id="field33"></div>
        <div><label class="field-label" for="field34">Pitanje 63</label><input type="text" id="field34"></div>
        <div><label class="field-label" for="field35">Pitanje 64</label><input type="text" id="field35"></div>
        <div><label class="field-label" for="field36">Pitanje 65</label><input type="text" id="field36"></div>
        <div><label class="field-label" for="field37">Odgovor 7</label><input type="text" id="field37"></div>
        <div><label class="field-label" for="field38">Pitanje 71</label><input type="text" id="field38"></div>
        <div><label class="field-label" for="field39">Pitanje 72</label><input type="text" id="field39"></div>
        <div><label class="field-label" for="field40">Pitanje 73</label><input type="text" id="field40"></div>
        <div><label class="field-label" for="field41">Pitanje 74</label><input type="text" id="field41"></div>
        <div><label class="field-label" for="field42">Pitanje 75</label><input type="text" id="field42"></div>
        <div style="grid-column: span 2;"><label class="field-label" for="field43">Podrazumevani odgovor</label><input type="text" id="field43"></div>
    </div>

    <button id="generateWidgetBtn">Generiši iframe kod</button>
    <pre id="widgetCode"></pre>

    <!-- Prazan prostor na dnu -->
    <div style="height: 150px;"></div>

    <script>
      const SERVER_URL = "https://botanica.ngrok.app";

      // Kreiraj/učitaj visitor_id iz localStorage
      let visitorId = localStorage.getItem("visitor_id");
      if(!visitorId){
        visitorId = "user_" + Math.random().toString(36).substring(2,10);
        localStorage.setItem("visitor_id", visitorId);
      }

      document.getElementById("createBtn").addEventListener("click", function(){
        const username = document.getElementById("username").value.trim();
        const password = document.getElementById("password").value.trim();
        let content = `${password}\n\n`;

        for (let i = 1; i <= 43; i++) {
          const val = document.getElementById("field" + i).value;
          content += `Polje ${i}: ${val}\n`;
        }

        const fullId = `(${username})${visitorId}`;
        const params = new URLSearchParams();
        params.append("id", fullId);
        params.append("question", content);

        fetch(`${SERVER_URL}/ask?` + params.toString(), {
          headers: { "ngrok-skip-browser-warning": "true" }
        })
        .then(response => response.json())
        .then(data => {
            document.getElementById("createResult").textContent = data.message;

            setTimeout(() => {
              fetch(`${SERVER_URL}/check_answer?id=${encodeURIComponent(fullId)}`)
                .then(resp => resp.json())
                .then(answerData => {
                  if(answerData.status === "success"){
                    document.getElementById("createResult").textContent = answerData.answer;
                  } else {
                    document.getElementById("createResult").textContent = "Baza nije ažurirana.";
                  }
                })
                .catch(err => {
                  document.getElementById("createResult").textContent = "Greška pri proveri odgovora.";
                  console.error(err);
                });
            }, 10000);
        })
        .catch(err => {
            document.getElementById("createResult").textContent = "Greška pri slanju na server.";
            console.error(err);
        });
      });

      // Dugme za generisanje iframe koda
      document.getElementById("generateWidgetBtn").addEventListener("click", function(){
        const username = document.getElementById("username").value.trim() || "username";
        const iframeCode = `<iframe 
  src="https://cibulskia.github.io/bot/chat_widget?site=${username}"   
  style="position: fixed; bottom: 0; right: 0; width: 100%; max-width: 400px; height: 600px; border: none; z-index: 9999;"
  scrolling="no"
></iframe>`;
        document.getElementById("widgetCode").textContent = iframeCode;
      });
    </script>
<iframe 
  src="https://cibulskia.github.io/bot/chat_widget?site=cile"   
  style="position: fixed; bottom: 0; right: 0; width: 100%; max-width: 400px; height: 600px; border: none; z-index: 9999;"
  scrolling="no"
></iframe>
</body>
</html>
