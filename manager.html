<!DOCTYPE html>
<html lang="sr">
<head>
<meta charset="UTF-8">
<title>SQL Manager (43 polja + login)</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
input { width: 90%; padding: 5px; margin: 3px 0 10px 0; }
label { font-weight: bold; display: block; margin-top: 5px; }
button { margin: 10px 5px 10px 0; padding: 8px 16px; }
.grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; }
#readResult { background: #f4f4f4; padding: 10px; border: 1px solid #ccc; white-space: pre-wrap; max-height: 300px; overflow-y: auto; }
.login-box { border: 1px solid #aaa; padding: 15px; margin-bottom: 20px; background: #fafafa; }
</style>
</head>
<body>
<h2>Prijava</h2>
<div class="login-box">
<label for="username">Korisničko ime</label>
<input type="text" id="username" placeholder="Unesi korisničko ime">
<label for="password">Lozinka</label>
<input type="password" id="password" placeholder="Unesi lozinku">
<button id="loginBtn">Login</button>
<button id="logoutBtn">Logout</button>
<p id="loginMsg"></p>
</div>

<h2>Kreiraj bazu</h2>
<button id="createBtn">Kreiraj</button><br>
<input type="text" id="createName" placeholder="Ime fajla"><br>

<div class="grid" id="fieldsGrid">
<!-- polja 1-43 -->
<script>
for (let i=1;i<=43;i++){
  const div=document.createElement("div");
  const label=document.createElement("label");
  label.textContent=`Polje ${i}`;
  label.setAttribute("for","field"+i);
  const input=document.createElement("input");
  input.type="text";
  input.id="field"+i;
  input.placeholder="Polje "+i;
  div.appendChild(label);
  div.appendChild(input);
  document.getElementById("fieldsGrid").appendChild(div);
}
</script>
</div>

<p id="createResult"></p>

<h2>Čitaj bazu</h2>
<input type="text" id="readName" placeholder="Ime fajla"><br>
<button id="readBtn">Čitaj</button>
<h3>Sadržaj fajla:</h3>
<pre id="readResult"></pre>

<script>
const SERVER_URL = "https://botanica.ngrok.app";

// LOGIN
document.getElementById("loginBtn").addEventListener("click", async ()=>{
  const username=document.getElementById("username").value.trim();
  const password=document.getElementById("password").value.trim();
  if(!username||!password){document.getElementById("loginMsg").textContent="Unesi korisničko ime i lozinku!";return;}
  try{
    const res=await fetch(`${SERVER_URL}/login`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({username,password}),
      credentials:"include"
    });
    const data=await res.json();
    document.getElementById("loginMsg").textContent=data.message||data.error;
  }catch(err){document.getElementById("loginMsg").textContent="Greška: "+err;}
});

// LOGOUT
document.getElementById("logoutBtn").addEventListener("click", async ()=>{
  try{
    const res=await fetch(`${SERVER_URL}/logout`,{method:"POST",credentials:"include"});
    const data=await res.json();
    document.getElementById("loginMsg").textContent=data.message||data.error;
  }catch(err){document.getElementById("loginMsg").textContent="Greška: "+err;}
});

// CREATE
document.getElementById("createBtn").addEventListener("click", async ()=>{
  const name=document.getElementById("createName").value.trim();
  if(!name){alert("Unesi ime fajla!");return;}
  const fields={};
  for(let i=1;i<=43;i++)fields["field"+i]=document.getElementById("field"+i).value.trim();
  try{
    const res=await fetch(`${SERVER_URL}/create_sql`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({name,...fields}),
      credentials:"include"
    });
    const data=await res.json();
    document.getElementById("createResult").textContent=data.message||data.error;
  }catch(err){document.getElementById("createResult").textContent="Greška: "+err;}
});

// READ
document.getElementById("readBtn").addEventListener("click", async ()=>{
  const name=document.getElementById("readName").value.trim();
  if(!name){alert("Unesi ime fajla!");return;}
  try{
    const res=await fetch(`${SERVER_URL}/read_sql`,{
      method:"POST",
      headers:{"Content-Type":"application/json"},
      body:JSON.stringify({name}),
      credentials:"include"
    });
    const data=await res.json();
    if(data.success){
      document.getElementById("readResult").textContent=data.content;
      for(let i=1;i<=43;i++)
        document.getElementById("field"+i).value=data["field"+i]||"";
    }else{
      document.getElementById("readResult").textContent=data.error;
    }
  }catch(err){document.getElementById("readResult").textContent="Greška: "+err;}
});
</script>
</body>
</html>
