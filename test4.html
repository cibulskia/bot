<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sigurno dugme</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
</head>
<body>
<button id="secureButton" disabled>Pristisni dugme</button>

<script>
const CLIENT_ID = "252373158568-4up41b7jo8ik6cu8c1pl3mlvvck2sq2t.apps.googleusercontent.com";
let googleToken = null;

// Inicijalizacija Google One Tap / autologin
window.onload = () => {
    google.accounts.id.initialize({
        client_id: CLIENT_ID,
        auto_select: true,
        callback: handleCredentialResponse
    });
    google.accounts.id.prompt(); // prikazuje prompt ako nije ulogovan
};

function handleCredentialResponse(response) {
    // response.credential je ID token
    googleToken = response.credential;
    document.getElementById("secureButton").disabled = false;
}

// Dugme
document.getElementById("secureButton").addEventListener("click", async () => {
    if (!googleToken) return alert("Niste ulogovani");

    try {
        const res = await fetch("https://botanica.ngrok.app/click", {
            method: "POST",
            headers: {
                "Authorization": `Bearer ${googleToken}`,
                "Content-Type": "application/json"
            }
        });
        const data = await res.json();
        alert(data.message || data.error);
    } catch (err) {
        console.error(err);
        alert("Gre≈°ka pri komunikaciji sa serverom");
    }
});
</script>
</body>
</html>
