<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sigurno Dugme</title>
<script src="https://accounts.google.com/gsi/client" async defer></script>
<style>
    body { font-family: sans-serif; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; background-color: #f0f2f5; padding: 20px; }
    button { padding: 10px 20px; margin: 5px; font-size: 16px; border-radius: 6px; border: none; cursor: pointer; background-color: #007bff; color: #fff; transition: 0.2s; }
    button:disabled { background-color: #cccccc; cursor: not-allowed; }
    button:hover:enabled { background-color: #0056b3; }
    input, select { margin: 5px; padding: 5px; font-size: 14px; }
    #statusMessage { margin-top: 15px; font-size: 14px; color: #333; }
    .section { border: 1px solid #ccc; border-radius: 8px; padding: 15px; margin: 10px; width: 100%; max-width: 500px; background: #fff; }
    h2 { margin-top: 0; }
</style>
</head>
<body>

<div class="section">
    <h2>Prijava i glavno dugme</h2>
    <div id="g_id_onload"
         data-client_id="252373158568-4up41b7jo8ik6cu8c1pl3mlvvck2sq2t.apps.googleusercontent.com"
         data-callback="handleCredentialResponse"
         data-auto_select="true"
         data-ux_mode="popup">
    </div>
    <button id="secureButton" disabled>Pritisni dugme</button>
    <p id="statusMessage">Čekam Google prijavu...</p>
</div>

<div class="section">
    <h2>Kategorija</h2>
    <button id="loadCategory" disabled>Učitaj kategoriju</button>
    <button id="updateCategory" disabled>Sačuvaj kategoriju</button>
    <button id="deleteCategory" disabled>Obriši kategoriju</button>
    <div>
        <label><input type="checkbox" id="checkbox1"> Checkbox 1</label>
        <label><input type="checkbox" id="checkbox2"> Checkbox 2</label>
        <label><input type="checkbox" id="checkbox3"> Checkbox 3</label>
        <label><input type="checkbox" id="checkbox4"> Checkbox 4</label>
    </div>
    <div>
        <select id="select1"><option value="">--Odaberi--</option><option>Opcija A</option><option>Opcija B</option></select>
        <select id="select2"><option value="">--Odaberi--</option><option>Opcija A</option><option>Opcija B</option></select>
        <select id="select3"><option value="">--Odaberi--</option><option>Opcija A</option><option>Opcija B</option></select>
    </div>
    <div>
        <input type="text" id="text1" placeholder="Text 1">
        <input type="text" id="text2" placeholder="Text 2">
    </div>
</div>

<div class="section">
    <h2>Podkategorije</h2>
    <button id="loadSubcategories" disabled>Lista podkategorija</button>
    <button id="createSubcategory" disabled>Kreiraj podkategoriju</button>
    <div id="subcategoriesList"></div>
</div>

<script>
let googleToken = null;

// --- Google One Tap callback ---
window.handleCredentialResponse = (response) => {
    if (response.credential) {
        googleToken = response.credential;
        document.querySelectorAll("button").forEach(btn => btn.disabled = false);
        document.getElementById("statusMessage").textContent = "Uspesno ulogovani!";
    } else {
        googleToken = null;
        document.getElementById("statusMessage").textContent = "Prijava nije uspela.";
    }
};

// --- Funkcija za fetch sa autorizacijom ---
async function authFetch(url, options = {}) {
    if (!googleToken) throw new Error("Niste ulogovani!");
    options.headers = options.headers || {};
    options.headers["Authorization"] = `Bearer ${googleToken}`;
    options.headers["Content-Type"] = "application/json";
    const res = await fetch(url, options);
    const data = await res.json();
    if (!res.ok) throw new Error(data.error || "Nepoznata greška");
    return data;
}

// --- Glavno dugme ---
document.getElementById("secureButton").addEventListener("click", async () => {
    try {
        const data = await authFetch("https://botanica.ngrok.app/click", { method: "POST" });
        document.getElementById("statusMessage").textContent = data.message;
    } catch (err) {
        document.getElementById("statusMessage").textContent = "Greška: " + err.message;
    }
});

// --- Kategorija ---
document.getElementById("loadCategory").addEventListener("click", async () => {
    try {
        const data = await authFetch("https://botanica.ngrok.app/category/load");
        document.getElementById("checkbox1").checked = data.checkbox1;
        document.getElementById("checkbox2").checked = data.checkbox2;
        document.getElementById("checkbox3").checked = data.checkbox3;
        document.getElementById("checkbox4").checked = data.checkbox4;
        document.getElementById("select1").value = data.select1 || "";
        document.getElementById("select2").value = data.select2 || "";
        document.getElementById("select3").value = data.select3 || "";
        document.getElementById("text1").value = data.text1 || "";
        document.getElementById("text2").value = data.text2 || "";
        document.getElementById("statusMessage").textContent = "Kategorija učitana!";
    } catch (err) {
        document.getElementById("statusMessage").textContent = "Greška: " + err.message;
    }
});

document.getElementById("updateCategory").addEventListener("click", async () => {
    try {
        const payload = {
            checkbox1: document.getElementById("checkbox1").checked ? 1 : 0,
            checkbox2: document.getElementById("checkbox2").checked ? 1 : 0,
            checkbox3: document.getElementById("checkbox3").checked ? 1 : 0,
            checkbox4: document.getElementById("checkbox4").checked ? 1 : 0,
            select1: document.getElementById("select1").value,
            select2: document.getElementById("select2").value,
            select3: document.getElementById("select3").value,
            text1: document.getElementById("text1").value,
            text2: document.getElementById("text2").value
        };
        await authFetch("https://botanica.ngrok.app/category/update", { method: "POST", body: JSON.stringify(payload) });
        document.getElementById("statusMessage").textContent = "Kategorija sačuvana!";
    } catch (err) {
        document.getElementById("statusMessage").textContent = "Greška: " + err.message;
    }
});

document.getElementById("deleteCategory").addEventListener("click", async () => {
    try {
        await authFetch("https://botanica.ngrok.app/category/delete", { method: "DELETE" });
        document.getElementById("statusMessage").textContent = "Kategorija i podkategorije obrisane!";
    } catch (err) {
        document.getElementById("statusMessage").textContent = "Greška: " + err.message;
    }
});

// --- Podkategorije ---
async function renderSubcategories() {
    const container = document.getElementById("subcategoriesList");
    container.innerHTML = "";
    try {
        const list = await authFetch("https://botanica.ngrok.app/subcategory/list");
        if (list.length === 0) container.textContent = "Nema podkategorija.";
        list.forEach(sub => {
            const div = document.createElement("div");
            div.style.border = "1px solid #ccc"; div.style.padding = "5px"; div.style.margin = "5px 0";
            div.innerHTML = `
                <strong>${sub.name}</strong>
                <button data-id="${sub.id}" class="editSub">Edit</button>
                <button data-id="${sub.id}" class="deleteSub">Delete</button>
            `;
            container.appendChild(div);
        });

        // Edit
        container.querySelectorAll(".editSub").forEach(btn => {
            btn.addEventListener("click", async () => {
                const subId = btn.dataset.id;
                const name = prompt("Unesite novo ime podkategorije:");
                if (!name) return;
                await authFetch(`https://botanica.ngrok.app/subcategory/update/${subId}`, {
                    method: "POST",
                    body: JSON.stringify({ name })
                });
                await renderSubcategories();
            });
        });

        // Delete
        container.querySelectorAll(".deleteSub").forEach(btn => {
            btn.addEventListener("click", async () => {
                if (!confirm("Obrisati podkategoriju?")) return;
                const subId = btn.dataset.id;
                await authFetch(`https://botanica.ngrok.app/subcategory/delete/${subId}`, { method: "DELETE" });
                await renderSubcategories();
            });
        });

    } catch (err) {
        container.textContent = "Greška: " + err.message;
    }
}

document.getElementById("loadSubcategories").addEventListener("click", renderSubcategories);

document.getElementById("createSubcategory").addEventListener("click", async () => {
    const name = prompt("Ime nove podkategorije:");
    if (!name) return;
    try {
        await authFetch("https://botanica.ngrok.app/subcategory/create", {
            method: "POST",
            body: JSON.stringify({ name })
        });
        await renderSubcategories();
    } catch (err) {
        document.getElementById("statusMessage").textContent = "Greška: " + err.message;
    }
});
</script>
</body>
</html>


